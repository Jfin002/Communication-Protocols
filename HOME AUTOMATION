Main.c:

#include "stdio.h"
#include "stm32f4xx.h"
#include "home_automation.h"

#define GPIODEN      (1U<<3)
#define LED_PIN      (1U<<13)

volatile char KEY;   // ðŸ‘ˆ required for Live Expressions

int main(void)
{
    /* Enable GPIOD clock */
    RCC->AHB1ENR |= GPIODEN;


    		//SET PD13 AS OUTPUT PIN -> 27,26  (01)
    		GPIOD->MODER &= ~(1U<<27);
    		GPIOD->MODER |= 1U<<26;

    UART2_RxTx_Init();

    printf("UART Ready\r\n");

    while (1)
    {
        KEY = uart2_read();   // blocking read

        /* Echo received data */
        printf("RX: %c\r\n", KEY);

        if (KEY == '1')
        {
            GPIOD->ODR |= LED_PIN;
            printf("LED ON\r\n");
        }
        else if (KEY == '0')
        {
            GPIOD->ODR &= ~LED_PIN;
            printf("LED OFF\r\n");
        }
        /* Ignore CR/LF */
    }
}

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Source file:

/*
 * Home_Automation.c
 *
 *  Created on: Feb 9, 2026
 *      Author: jeffin
 */


#include "home_automation.h"


#define GPIOAEN     (1<<0)
#define UART2EN     (1<<17)

#define CR1_TE       (1<<3)
#define CR1_RE       (1<<2)

#define CR1_UE       (1<<13)
#define SR_TXE       (1<<7)
#define SR_RXNE       (1<<5)

#define SYS_FREQ     16000000
#define APB1_CLK     SYS_FREQ
#define UART_BAUDRATE   9600


static void uart_set_baudrate(USART_TypeDef *USARTx,uint32_t PeriphClk, uint32_t BaudRate );
static uint16_t compute_uart_bd(uint32_t PeriphClk, uint32_t BaudRate);



int __io_putchar(int ch)
{
	//MAKE SURE THE TRANSMIT DATA TRANSFER IS EMPTY
		while(!(USART2 ->SR & SR_TXE))
		{

		}
		//WRITE TO TRANSMIT DATA REGISTER WITH REFERENCE MANUAL 19.6.1
		USART2 ->DR =(ch &0xFF);
	  return ch;
}


/* CONFIGURE UART GPIO PIN
 * FROM ALTERNATE FN. TABLE 9 USART2_TX ->PA2 -> AF07
	 */

void UART2_TX_Init(void)
{
	 /******CONFIGURE UART GPIO PIN***********/

	 //ENABLE DATA BUS WITH REFERNCE MANUAL 6.3.11
	  RCC ->AHB1ENR |= GPIOAEN;
	//SET PA2 MODE TO ALTERNATE FUNCTION MODE WITH REFERNCE MANUAL 8.4.1
	 GPIOA ->MODER &=~(1<<4);
	 GPIOA ->MODER |=(1<<5);
	/*SET PA2 ALTERNATE FUNCTION TYPE TO UART_TX(AF07)
	 * WITH REFERNCE MANUAL 8.4.9
	 * HERE PA2 -> AFRL2 (BIT 8,9,10,11)
	 * AF7 -> 0111    AFRL ->AFR[0]   AFRH ->AFR[1]
	 */
     GPIOA ->AFR[0]|=(1<<8);
     GPIOA ->AFR[0]|=(1<<9);
     GPIOA ->AFR[0]|=(1<<10);
     GPIOA ->AFR[0]&=~(1<<11);
	 /******CONFIGURE UART MODULE***********/

	//ENBALE CLOCK ACCESS TO UART2
	RCC ->APB1ENR |= UART2EN;
	//CONFIGURE BAUDRATE
	uart_set_baudrate(USART2,APB1_CLK, UART_BAUDRATE );
	//CONFIGURE TRANSFER DIRECTION WITH REFERNCE MANUAL 19.6.4 USART_CR1
	USART2 ->CR1 = CR1_TE;
	// ENABLE UART MODULE WITH CONTROL REGISTER 1
	USART2 ->CR1 |= CR1_UE;


}

void UART2_RxTx_Init(void)
{
	 /******CONFIGURE UART GPIO PIN***********/

	 //ENABLE DATA BUS WITH REFERNCE MANUAL 6.3.11
	  RCC ->AHB1ENR |= GPIOAEN;
	//SET PA2,PA3 MODE TO ALTERNATE FUNCTION MODE WITH REFERNCE MANUAL 8.4.1
	 GPIOA ->MODER &=~(1<<4);
	 GPIOA ->MODER |=(1<<5);
	 GPIOA ->MODER &=~(1<<6);
	 GPIOA ->MODER |=(1<<7);
	/*SET PA2 ALTERNATE FUNCTION TYPE TO UART_TX(AF07)
	 * WITH REFERNCE MANUAL 8.4.9
	 * HERE PA2 -> AFRL2 (BIT 8,9,10,11)
	 * AF7 -> 0111    AFRL ->AFR[0]   AFRH ->AFR[1]
    /* Clear AF */
    GPIOA->AFR[0] &= ~(0xFFU << 8);

    /* AF7 for USART2 */
    GPIOA->AFR[0] |=  (0x77U << 8);


	 /******CONFIGURE UART MODULE***********/

	//ENBALE CLOCK ACCESS TO UART2
	RCC ->APB1ENR |= UART2EN;
	//CONFIGURE BAUDRATE
	uart_set_baudrate(USART2,APB1_CLK, UART_BAUDRATE );
	//CONFIGURE TRANSFER DIRECTION WITH REFERNCE MANUAL 19.6.4 USART_CR1
	USART2 ->CR1 = (CR1_TE | CR1_RE);
	// ENABLE UART MODULE WITH CONTROL REGISTER 1
	USART2 ->CR1 |= CR1_UE;


}


char uart2_read(void)
{
	//MAKE SURE THE RECEIVE DATA REGISTER IS EMPTY
	//WITH REFERENCE MANUAL 19.6.1
	while(!(USART2 ->SR & SR_RXNE));
	//READ DATA
    return USART2 ->DR;

}




static void uart_set_baudrate(USART_TypeDef *USARTx,uint32_t PeriphClk, uint32_t BaudRate )
{
	USARTx ->BRR =compute_uart_bd(PeriphClk,BaudRate);
}

static uint16_t compute_uart_bd(uint32_t PeriphClk, uint32_t BaudRate)
{
	return (PeriphClk + (BaudRate/2U)) /BaudRate;
}

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Header file:

/*
 * Home_Automation.h
 *
 *  Created on: Feb 9, 2026
 *      Author: jeffin
 */

#ifndef INC_HOME_AUTOMATION_H_
#define INC_HOME_AUTOMATION_H_

#include "stm32f4xx.h"
#include "stdint.h"


char uart2_read(void);
void UART2_RxTx_Init(void);

#endif /* INC_HOME_AUTOMATION_H_ */
